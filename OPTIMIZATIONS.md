# 🚀 TaskCube 优化与改进文档

本文档旨在记录那些超越具体功能、专注于提升应用**性能、可维护性、用户体验细节**和**架构健壮性**的长期优化方向。它与 `ROADMAP.md` 相互补充，后者更侧重于用户可见的新功能迭代。

---

## ⚡️ 性能优化 (Performance Optimization)

随着用户数据的增长，确保应用的响应速度和流畅度至关重要。

### 1. 列表虚拟化 (List Virtualization)
*   **状态**: ✅ **已实现 (v2.10.0)**
*   **问题描述**: 在实现虚拟化之前，`TableView` 会一次性渲染所有可见任务。当任务数量巨大时（如 500+），这会导致滚动卡顿和内存占用过高。
*   **实现方案**:
    *   引入了 **`@tanstack/react-virtual`** 库。
    *   重构了 `TableView` 组件，将原有的 `<tbody>` 替换为一个由虚拟化库驱动的 `<div>` 容器。
    *   该技术只在 DOM 中创建并渲染当前视口内可见的任务行，当用户滚动时，动态回收离开视口的 DOM 节点并**复用**它们来显示新数据。
    *   **结果**: 无论列表有多长（即使包含数千个任务），DOM 节点的数量始终保持在一个很小的常数水平，实现了极致的滚动性能和极低的内存占用。

### 2. 组件懒加载 (Component Lazy Loading)
*   **现状**: 应用启动时，可能会一次性加载所有主视图（日历、日、看板、表格）的代码，即使用户当前只看到了其中一个。
*   **优化方案**: 使用 `React.lazy` 和 `Suspense` 对四大主视图进行代码分割。这样，只有当用户切换到某个视图时，对应的代码块才会被下载和执行，从而加快应用的初始加载速度。

### 3. 精细化的状态管理 (Refined State Management)
*   **现状**: `App.tsx` 作为根组件管理了大量全局状态。某些局部状态的改变（例如打开一个筛选菜单）可能会导致不必要的大范围组件重新渲染。
*   **优化方案**:
    *   **状态下放 (State Colocation)**: 将一些仅在特定视图中使用的状态（如 `TableView` 的筛选条件）从 `App.tsx` 下移到对应组件内部管理。
    *   **使用 `React.memo`**: 对那些 props 不经常变化且渲染开销较大的组件（如 `MonthBlock` 或 `MatrixTaskCard`）进行包裹，避免不必要的重复渲染。

---

## ✨ UI/UX 细节打磨 (UI/UX Refinements)

细节决定体验。这些改进能让应用感觉更“精致”和“贴心”。

### 1. 加载状态骨架屏 (Loading Skeletons)
*   **现状**: 数据加载时（虽然 Dexie 很快，但初次加载或大量查询时仍有微小延迟），界面可能短暂空白。
*   **优化方案**: 在数据加载期间，显示与最终内容布局相似的骨架屏。这能极大地改善感知性能，让用户感觉应用响应更快，并避免内容加载时产生的界面布局跳动。

### 2. 上下文感知的界面 (Context-Aware UI)
*   **现状**: 应用顶部的操作栏在所有视图下基本是固定的。
*   **优化方案**: 让顶栏的控件根据当前视图动态变化。例如，在“看板视图”中，显示“按时间范围筛选”；在“列表视图”中，则隐藏日期导航，让界面更简洁，只展示与当前上下文最相关的操作。

### 3. 过滤器持久化与预设 (Filter Persistence & Presets)
*   **现状**: 在 `TableView` 中设置的筛选条件，在刷新页面后会丢失。
*   **优化方案**:
    1.  将用户的筛选配置保存到 `localStorage` 中，恢复上次的筛选状态。
    2.  允许用户将常用的筛选组合保存为“预设视图”（例如：“本周高优任务”），方便一键切换。

---

## 💾 数据与架构 (Data & Architecture)

### 1. 可选的端到端加密同步 (Optional E2EE Sync)
*   **现状**: 纯本地优先，保证了隐私但限制了跨设备使用。
*   **优化方案**: 提供一个**可选的**同步功能。用户可以连接自己的云存储（如 S3、WebDAV），所有数据在上传前进行**端到端加密 (E2EE)**，确保服务器也无法读取用户数据。这样既解决了多设备同步的需求，又保留了隐私优先的核心理念。

### 2. 增强的数据导入/导出 (Enhanced Import/Export)
*   **现状**: 支持 JSON 格式的完全备份和恢复。
*   **优化方案**:
    *   **增量导入**: 支持“合并”而不是“覆盖”式导入，避免用户丢失在两次导出之间新创建的数据。
    *   **格式兼容**: 支持导出为 CSV 或 Markdown 格式，方便用户在其他工具（如 Excel, Notion）中使用自己的数据。

---

## 🧠 AI 功能深化 (Deeper AI Integration)

除了路线图中规划的 AI 功能，还可以从其他角度深化 AI 的应用。

### 1. AI 智能排序与分组 (AI-Powered Sorting/Grouping)
*   **现状**: 任务排序是固定的（按日期、优先级等）。
*   **优化方案**: 在 `TableView` 中增加一个“AI 智能排序”选项。用户可以输入自然语言指令，如“按‘发布新版本’项目的重要性排序”，AI 会分析所有任务的标题和描述，动态调整它们的显示顺序。

### 2. AI 总结与复盘 (AI Summaries & Reviews)
*   **现状**: 用户需要手动回顾已完成的任务。
*   **优化方案**: 增加一个“AI 复盘”功能。用户可以选择一个时间范围或一个项目，AI 会自动分析相关的已完成任务，生成一份简洁的总结报告，例如：“上周您完成了 15 项任务，主要集中在‘营销活动’项目上。做得不错！”

---

> 👉 这个文档旨在补充 [ROADMAP.md](./ROADMAP.md)，共同指导 TaskCube 的发展。