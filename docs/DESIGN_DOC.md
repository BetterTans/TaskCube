# TaskCube - 软件设计与架构文档

**文档版本**: 1.2
**最后更新**: v3.1.2

---

## 1. 概述与核心原则

### 1.1 架构演进：零构建 (Zero-Build)
从 v3.1.2 开始，TaskCube 转向了**零构建架构**。这意味着应用不再依赖本地的构建工具（如 Vite 或 Webpack）。

*   **动机**: 降低开发门槛，实现“即开即用”。
*   **实现**: 利用浏览器原生的 ES Modules (ESM) 能力，结合 `esm.sh/run` 加载器。

---

## 2. 系统架构

### 2.1 运行时环境 (Runtime Environment)

应用的核心是一个 `index.html`，它通过以下技术栈实现免编译运行：

*   **`importmap`**: 在浏览器中定义模块别名（如 `react`, `lucide-react`），这些模块直接从 CDN (`esm.sh`) 加载。
*   **`esm.sh/run`**: 这是一个基于 Service Worker 的运行时。它拦截浏览器对 `.tsx` 或 `.ts` 文件的请求，在客户端实时将其编译为可执行的 JavaScript。
*   **原生 ESM 限制**: 在此架构下，所有的 `import` 语句必须包含**显式的文件扩展名**（例如 `import App from './App.tsx'`）。

### 2.2 数据持久层 (Data Layer)
*   **Dexie.js**: 依然作为核心存储引擎，通过 IndexedDB 提供本地持久化。由于 `esm.sh/run` 支持依赖处理，`Dexie` 能够正常与 React 钩子集成。

---

## 3. 核心功能实现

### 3.1 模块加载逻辑
1. 浏览器加载 `index.html`。
2. 注册 `importmap`。
3. 启动 `esm.sh/run` 脚本。
4. `index.html` 加载 `<script type="text/tsx" src="./index.tsx">`。
5. `esm.sh/run` 拦截并编译 `index.tsx` 及其引用的所有 TSX 模块。

### 3.2 样式系统
采用 Tailwind CSS 的 CDN 模式。虽然官方不建议生产环境使用此模式，但对于“本地优先”和“工具型”应用，这种模式提供了无与伦比的灵活性，无需配置任何 PostCSS 流程。

---

## 4. 优势与局限性

### 优势
*   **环境无关**: 不再需要 `node_modules` 文件夹。
*   **即时开发**: 修改代码后刷新页面即可看到效果，无需等待构建。
*   **部署简单**: 可以托管在任何静态文件服务器或直接在本地通过 WebStorm 打开。

### 局限性
*   **首次加载延迟**: 浏览器在首次运行或刷新时需要编译 TSX，可能会有 1-2 秒的白屏。
*   **网络依赖**: 开发时需要联网以从 CDN 加载核心库（React 等）。

---

## 5. 文档历史
*   **v1.2 (v3.1.2)**: 详细记录了 `esm.sh/run` 的运行时架构。
*   **v1.1 (v3.1.1)**: 更新了四象限颜色系统和浮窗动画优化。