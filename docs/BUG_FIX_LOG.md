# 🐞 Bug 修复日志 (Bug Fix Log)

本文档旨在追踪并记录 NextDo 项目中已识别并修复的关键 Bug，以便于版本追溯和问题复盘。

---

## v3.1.2

*   **核心目标**: 彻底根除 UI 渲染瑕疵，提升交互的丝滑感。

### ✅ 已修复: 表格视图筛选浮窗动画起点异常

*   **故障现象 (Symptom)**: 
    在“列表视图”中，点击列标题的筛选按钮后，弹出的筛选框会从屏幕左上角 (0,0) 的位置“飞”到目标位置，动画效果不符合预期，显得非常突兀。

*   **根本原因 (Root Cause)**:
    这是一个经典的 React 渲染时序问题。组件的 `useEffect` 或 `useLayoutEffect` 在组件**首次渲染到 DOM 之后**才会执行位置计算。这意味着：
    1.  第一帧：组件以其默认 `style` (top: 0, left: 0) 被渲染。
    2.  第二帧：`useLayoutEffect` 同步执行，计算出正确的位置并更新 state，触发重渲染，组件“跳”到正确位置。
    虽然这个过程极快，但 `animate-in` 动画捕捉到了这个从 (0,0) 到目标位置的剧烈变化，从而产生了“飞入”的视觉瑕疵。

*   **解决方案 (Resolution)**:
    在 `TableView.tsx` 的 `FilterPopover` 组件中，将位置计算逻辑从 `useEffect`/`useLayoutEffect` 迁移到了 **`useMemo`**。`useMemo` 在组件的渲染阶段同步执行，这意味着在组件首次被渲染到 DOM **之前**，正确的位置坐标就已经计算完毕并直接应用到了 `style` 属性上。因此，组件的第一帧就出现在了正确的位置，彻底消除了位置跳变，使得弹出动画平滑自然。

---

## v3.1.1

*   **核心目标**: 修复用户反馈的核心交互 Bug，提升应用的稳定性。

### ✅ 已修复: 表格视图筛选按钮重复点击导致白屏崩溃

*   **故障现象 (Symptom)**: 
    在“列表视图”中，当用户点击一个列标题旁的筛选按钮打开筛选浮窗后，如果再次点击同一个筛选按钮（意图关闭浮窗），整个应用会崩溃并显示白屏。

*   **根本原因 (Root Cause)**:
    这是一个由 **`mousedown` 和 `click` 事件竞争** 导致的渲染冲突。当再次点击筛选按钮时：
    1.  首先，`mousedown` 事件触发了全局的“点击外部关闭”监听器，该监听器立即执行了关闭浮窗的逻辑。
    2.  紧接着，`click` 事件（在 `mouseup` 之后触发）又执行了按钮自身的点击处理逻辑，该逻辑再次尝试关闭同一个（可能即将被卸载的）浮窗。
    这种在极短时间内对同一个组件进行两次关闭操作的行为，导致了 React 渲染周期的崩溃。

*   **解决方案 (Resolution)**:
    在 `TableView.tsx` 中，为筛选按钮添加了 `onMouseDown={e => e.stopPropagation()}` 事件处理器。这会阻止 `mousedown` 事件从按钮“冒泡”到顶层的 `document`，从而禁用了全局的“点击外部关闭”监听器。这样，只有按钮自身的 `click` 事件能够触发关闭逻辑，确保了关闭操作只被执行一次，彻底消除了事件竞争，解决了该崩溃问题。

---

## v2.10.1

*   **核心目标**: 修复用户反馈的三个核心体验问题，提升应用的稳定性和可用性。

### ✅ 已修复: 新建任务时 AI 分析状态未重置
*   **解决方案**: 在 `TaskDetailModal.tsx` 的主 `useEffect` 钩子中强制添加了 `setIsSmartFilling(false);`，确保每次打开模态框时 AI 状态都被可靠重置。

### ✅ 已修复: 表格视图 (Table View) 未显示子任务进度
*   **解决方案**: 在 `TableView.tsx` 中实现了“子任务”列的渲染逻辑，显示 `完成数/总数` 进度。

### ✅ 已修复: 表格视图列标题显示不全
*   **解决方案**: 调整了 `colWidths` 的默认值，为中文标题提供了足够的初始显示空间。

---

## v2.8.2

*   **核心目标**: 修复导致应用崩溃的核心稳定性问题。

### ✅ 已修复: 编辑旧任务时，模态框崩溃并引发 "Script error"
*   **解决方案**: 加固了 `TaskDetailModal.tsx` 的状态初始化逻辑，为可能缺失的 `task.date` 字段提供了回退值，防止状态被设置为 `undefined`。

---

## v2.8.1

*   **核心目标**: 修复导致应用部分功能不可用的严重 Bug。

### ✅ 已修复: 列表视图 (Table View) 崩溃导致白屏
*   **解决方案**: 对 `TableView` 组件的筛选逻辑和过滤器加载逻辑进行了加固，增加了安全回退 `(task.title || '')`，确保即使 `title` 字段缺失或被意外存为 `null`，代码也能稳定运行。