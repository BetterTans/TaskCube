📄 **TaskCube v3.2 需求文档（PRD）**

---

### 1. 文档信息

| 项目         | 内容               |
|--------------|--------------------|
| **产品名称** | TaskCube           |
| **版本**     | v3.2               |
| **负责人**   | 唐绍权             |
| **目标发布时间**| TBD                |
| **文档类型** | 功能 PRD           |
| **优先级**   | P0（核心能力升级） |

---

### 2. 背景与问题定义

#### 2.1 当前现状

TaskCube 已具备：
- 完整任务 / 项目 / 依赖 / 多视图体系
- AI 创建、拆解任务能力
- 高性能本地数据架构（Dexie + 虚拟化）

#### 2.2 核心问题

用户在使用过程中，仍存在以下关键痛点：
1.  **决策成本高**
    -   用户知道“有什么任务”
    -   但不知道“现在最该做哪一个”
2.  **时间利用不友好**
    -   任务与真实可用时间之间存在断层
    -   日程不是日历型用户也难以规划
3.  **AI 停留在被动工具**
    -   需要用户主动询问
    -   没有持续决策辅助能力

---

### 3. 产品目标（v3.2）

**核心目标一句话**

> 让 TaskCube 从「任务管理工具」升级为「执行决策助手」

**具体目标**
-   帮用户快速确定「下一步该做什么」
-   将任务与碎片化时间自然匹配
-   在不增加复杂度的前提下，引入 AI 决策能力

---

### 4. 核心功能一：Next Action（下一步行动引擎）

#### 4.1 功能概述

系统自动从所有“可执行任务”中，筛选出 1–3 个当前最优任务，作为用户的“下一步行动建议”。

#### 4.2 适用范围
-   所有未完成任务
-   排除：
    -   被依赖阻塞的任务
    -   已延期至未来的任务

#### 4.3 计算规则（第一版）

Next Action Score = 加权评分模型：

| 因素           | 权重 | 说明                     |
|----------------|------|--------------------------|
| **依赖状态**   | 必须 | 仅选择无阻塞任务         |
| **截止时间**   | 高   | 越近分越高               |
| **优先级**     | 中   | P1 > P2 > P3             |
| **项目重要度** | 中   | 项目权重                 |
| **AI 推荐分**  | 中   | AI 语义判断              |
| **最近拖延惩罚**| 低   | 多次延期的任务降权       |

#### 4.4 UI 表现

**位置**
-   首页顶部独立区块
-   Focus Mode 入口页

**形式**
```
▶ 下一步行动
- [ ] 撰写技术方案（30min）
- [ ] 修复表格视图 Bug（45min）
```

**交互**
-   点击任务 → 进入详情
-   支持「刷新推荐」

#### 4.5 非目标（明确不做）
-   不强制用户执行
-   不自动修改任务状态

---

### 5. 核心功能二：任务时间语义（Soft Time Blocking）

#### 5.1 功能概述

为任务引入“时间语义”，但不强制绑定日历。

#### 5.2 新增字段

Task 扩展字段
```typescript
estimatedDuration: 15 | 30 | 45 | 60 | 90 | 120
preferredTimeSlot: "morning" | "afternoon" | "evening" | "any"
```

#### 5.3 创建任务时的行为
-   AI 自动识别耗时：
    -   “看一眼 / 回个消息” → 15min
    -   “整理 / 写方案” → 60min
-   用户可手动修改

#### 5.4 AI 使用方式

当用户：
-   进入 Focus Mode
-   点击「现在做什么？」

AI 结合：
-   当前时间段
-   剩余可用时长
-   Next Action 列表

返回：
> “你现在有约 40 分钟，最适合做：XXX”

---

### 6. 核心功能三：AI 智能推荐（被动 → 主动）

#### 6.1 功能定位

不是聊天机器人，而是决策增强模块。

#### 6.2 使用场景

| 场景       | 行为                 |
|------------|----------------------|
| **打开 App** | 自动生成 Next Action |
| **完成任务** | 轻量反馈 + 调整推荐  |
| **空闲时**   | 提供时间匹配建议     |

#### 6.3 Prompt 输入上下文（示例）
-   当前时间
-   今日剩余任务
-   最近完成情况
-   用户历史偏好（时段效率）

---

### 7. 辅助功能：完成反馈增强（P1）

#### 7.1 完成反馈
-   完成任务时：
    -   轻动画
    -   Toast 提示：「完成一步，离目标更近了」

#### 7.2 可选追问（可关闭）

> “这个任务耗时是否符合预期？”

用于：
-   校准 AI 时间预测
-   提升推荐准确度

---

### 8. 辅助功能：失败语义（P2）

#### 8.1 新状态

| 状态 | 含义         |
|------|--------------|
| 延期 | 主动调整     |
| 放弃 | 主动放弃     |
| 忽略 | 长期不处理   |

#### 8.2 数据用途
-   AI 分析拖延模式
-   周报 / 复盘使用

---

### 9. 数据与隐私
-   所有任务数据默认 **本地存储**
-   AI 请求仅上传：
    -   任务标题
    -   时间元信息
    -   不包含具体内容（可配置）

---

### 10. 成功指标（Success Metrics）

| 指标                 | 目标   |
|----------------------|--------|
| **日均完成任务数**   | +20%   |
| **打开即操作率**     | +30%   |
| **Next Action 点击率** | >50%   |
| **7 日留存**         | 提升   |

---

### 11. 不在本期范围（明确排除）
-   日历双向同步
-   多端云同步
-   团队协作

---

### 12. 总结（一句话）

v3.2 不是增加功能，而是让 TaskCube 帮用户“做决定”。
